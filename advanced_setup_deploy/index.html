<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Advanced Setup and Deployment - A2RCHI Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Advanced Setup and Deployment";
        var mkdocs_page_input_path = "advanced_setup_deploy.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> A2RCHI Docs
        </a>
        <div class="version">
          1.2.4
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">A2RCHI</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">Install</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../user_guide/">User Guide</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Advanced Setup and Deployment</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#configuring-podman">Configuring Podman</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#running-llms-locally-on-your-gpus">Running LLMs locally on your GPUs</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#helpful-notes-for-production-deployments">Helpful Notes for Production Deployments</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#running-multiple-deployments-on-the-same-machine">Running multiple deployments on the same machine</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#persisting-data-between-deployments">Persisting data between deployments</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api_reference/">API Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../developer_guide/">Developer Guide</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">A2RCHI Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Advanced Setup and Deployment</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/mit-submit/A2rchi/edit/master/docs/advanced_setup_deploy.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="advanced-setup-deployment">Advanced Setup &amp; Deployment</h1>
<p>Topics related to advanced setup and deployment of A2RCHI.</p>
<h2 id="configuring-podman">Configuring Podman</h2>
<p>To ensure your Podman containers stay running for extended periods, you need to enable lingering. To do this, run:</p>
<pre><code class="language-bash">loginctl enable-linger
</code></pre>
<p>To check or confirm the lingering status, run:</p>
<pre><code class="language-bash">loginctl user-status | grep -m1 Linger
</code></pre>
<p>See the Red Hat <a href="https://access.redhat.com/solutions/7054698">documentation</a> for additional context.</p>
<h2 id="running-llms-locally-on-your-gpus">Running LLMs locally on your GPUs</h2>
<p>There are a few additional system requirements for this to work:</p>
<ol>
<li>Make sure you have NVIDIA drivers installed.</li>
<li>(Optional) For the containers where A2RCHI will run to access the GPUs, install the <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">NVIDIA container toolkit</a>.</li>
<li>Configure the container runtime to access the GPUs.</li>
</ol>
<details>
<summary>For Podman</summary>

Run the following command:


<pre><code class="language-bash">sudo nvidia-ctk cdi generate --output=/etc/cdi/nvidia.yaml
</code></pre>


Then list the devices:


<pre><code class="language-bash">nvidia-ctk cdi list
</code></pre>


You should see output similar to:


<pre><code class="language-text">INFO[0000] Found 9 CDI devices
...
nvidia.com/gpu=0
nvidia.com/gpu=1
...
nvidia.com/gpu=all
...
</code></pre>


These listed "CDI devices" will be referenced to run A2RCHI on the GPUs, so make sure they are present. To learn more, consult the [Podman GPU documentation](https://podman-desktop.io/docs/podman/gpu).

</details>

<details>
<summary>For Docker</summary>

Run the following command:


<pre><code class="language-bash">sudo nvidia-ctk runtime configure --runtime=docker
</code></pre>


The remaining steps mirror the Podman flow. NOTE: this has not yet been fully tested with Docker. Refer to the [NVIDIA toolkit documentation](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html#configuration) for details.

</details>

<p>Once these requirements are met, the <code>a2rchi create [...] --gpu-ids &lt;gpus&gt;</code> option will deploy A2RCHI across your GPUs.</p>
<h2 id="helpful-notes-for-production-deployments">Helpful Notes for Production Deployments</h2>
<p>You may wish to use the CLI in order to stage production deployments. This section covers some useful notes to keep in mind.</p>
<h3 id="running-multiple-deployments-on-the-same-machine">Running multiple deployments on the same machine</h3>
<p>The CLI allows multiple deployments to run on the same daemon in the case of Docker (Podman has no daemon). The container networks between all the deployments are separate, so there is very little risk of them accidentally communicating with one another.</p>
<p>However, you need to be careful with the external ports. Suppose you're running two deployments and both of them are running the chat on external port 8000. There is no way to view both deployments at the same time from the same port, so instead you should forward the deployments to other external ports. Generally, this can be done in the configuration:</p>
<pre><code class="language-yaml">services:
  chat_app:
    external_port: 7862  # default is 7861
  uploader_app:
    external_port: 5004  # default is 5003
  grafana:
    external_port: 3001  # default is 3000
  chromadb:
    chromadb_external_port: 8001  # default is 8000
</code></pre>
<h3 id="persisting-data-between-deployments">Persisting data between deployments</h3>
<p>Volumes persist between deployments, so if you deploy an instance and upload additional documents, you do not need to redo this every time you deploy. If you are editing any data, explicitly remove this information from the volume, or remove the volume itself with:</p>
<pre><code class="language-bash">docker/podman volume rm &lt;volume-name&gt;
</code></pre>
<p>To see what volumes are currently present, run:</p>
<pre><code class="language-bash">docker/podman volume ls
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../user_guide/" class="btn btn-neutral float-left" title="User Guide"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../api_reference/" class="btn btn-neutral float-right" title="API Reference">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/mit-submit/A2rchi" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../user_guide/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../api_reference/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
