<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>User Guide - A2rchi Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "User Guide";
        var mkdocs_page_input_path = "user_guide.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> A2rchi Docs
        </a>
        <div class="version">
          1.1.0
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/">A2rchi</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">Install</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quickstart</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">User Guide</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-sources">Data Sources</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#web-link-lists">WEb Link Lists</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#git-scraping">Git scraping</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuration_1">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_1">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_1">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#jira">JIRA</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuration_2">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_2">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_2">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#adding-documents-and-the-uploader-interface">Adding Documents and the Uploader Interface</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#adding-documents">Adding Documents</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#manual-uploader">Manual Uploader</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#directly-copying-files-to-the-container">Directly copying files to the container</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#redmine">Redmine</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_3">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_3">Running</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#interfacesservices">Interfaces/Services</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#piazza-interface">Piazza Interface</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuration_3">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_4">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_4">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#redminemailbox-interface">Redmine/Mailbox Interface</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuration_4">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_5">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_5">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mattermost-interface">Mattermost Interface</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuration_5">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_6">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_6">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grafana-interface">Grafana Interface</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#configuration_6">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_7">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_7">Running</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#grader-interface">Grader Interface</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#secrets_8">Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#configuration_7">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#running_8">Running</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#models">Models</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#local-models">Local Models</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#models-via-apis">Models via APIs</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#ollama">Ollama</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#other">Other</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#add-chromadb-document-management-api-endpoints">Add ChromaDB Document Management API Endpoints</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#debugging-chromadb-endpoints">Debugging ChromaDB endpoints</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../advanced_setup_deploy/">Advanced Setup & Deployment</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../api_reference/">API Reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../developer_guide/">Developer Guide</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">A2rchi Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">User Guide</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/mit-submit/A2rchi/edit/master/docs/user_guide.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="user-guide">User Guide</h1>
<h2 id="overview">Overview</h2>
<p>A2rchi supports various <strong>data sources</strong> as easy ways to ingest your data into the vector store databased used for document retrieval. These include:</p>
<ul>
<li><strong>Links lists (even behind SSO)</strong>: automatically scrape and ingest documents from a list of URLs</li>
<li><strong>Git scraping</strong>: git mkdocs repositories</li>
<li><strong>Ticketing systems</strong>: JIRA, Redmine, Piazza</li>
<li><strong>Local documents</strong></li>
</ul>
<p>Additionally, A2rchi supports various <strong>interfaces/services</strong>, which are applications that interact with the RAG system. These include:</p>
<ul>
<li><strong>Chat interface</strong>: a web-based chat application</li>
<li><strong>Piazza integration</strong>: read posts from Piazza and post draft responses to a Slack channel</li>
<li><strong>Cleo/Redmine integration</strong>: read emails and create tickets in Redmine</li>
<li><strong>Mattermost integration</strong>: read posts from Mattermost and post draft responses to a Mattermost channel</li>
<li><strong>Grafana monitoring dashboard</strong>: monitor system and LLM performance metrics</li>
<li><strong>Document uploader</strong>: web interface for uploading and managing documents</li>
<li><strong>Grader</strong>: automated grading service for assignments with web interface</li>
</ul>
<p>Both data sources and interfaces/services are enabled via flags to the <code>a2rchi create</code> command,</p>
<pre><code class="language-bash">a2rchi create [...] --services=chatbot,piazza,jira,...
</code></pre>
<p>The parameters of the services are configured via the configuration file. See below for more details.</p>
<p>We support various <strong>pipelines</strong> which are pre-defined sequences of operations that process user inputs and generate responses.
Each service may support a given pipeline.
See the <code>Services</code> and <code>Pipelines</code> sections below for more details.
For each pipeline, you can use different models, retrievers, and prompts for different steps of the pipeline.
We support various <strong>models</strong> for both embeddings and LLMs, which can be run locally or accessed via APIs.
See the <code>Models</code> section below for more details.
Both pipelines and models are configured via the configuration file.</p>
<p>Finally, we support various <strong>retrievers</strong> and <strong>embedding techniques</strong> for document retrieval.
These are configured via the configuration file.
See the <code>Vector Store</code> section below for more details.</p>
<hr />
<h2 id="data-sources">Data Sources</h2>
<p>These are the different ways to ingest data into the vector store used for document retrieval.</p>
<h3 id="web-link-lists">WEb Link Lists</h3>
<p>A web link list is a simple text file containing a list of URLs, one per line.
A2rchi will fetch the content from each URL and add it to the vector store, using the <code>Scraper</code> class.</p>
<h4 id="configuration">Configuration</h4>
<p>You can define which lists of links A2rchi will inject in the configuration file as follows:</p>
<pre><code class="language-yaml">data_manager:
  input_lists:  # REQUIRED
    - configs/miscellanea.list  # list of websites with relevant info
    - [...other lists...]
</code></pre>
<p>Each list should be a simple text file containing one URL per line, e.g.,</p>
<pre><code>https://example.com/page1
https://example.com/page2
[...]
</code></pre>
<p>In the case that some of the links are behind a Single Sign-On (SSO) system, you can use the <code>SSOScraper</code>.
To enable it, add the enable it and pick the class you want in the configuration file:</p>
<pre><code class="language-yaml">utils:
  sso:
    sso_class: CERNSSO  # or whichever class you want to use
    enabled: true
</code></pre>
<h4 id="secrets">Secrets</h4>
<p>If you are using SSO, depending on the class, you may need to provide your login credentials in a secrets file as follows:</p>
<pre><code class="language-bash">SSO_USERNAME=username
SSO_PASSWORD=password
</code></pre>
<p>Then, make sure that the links you provide in the <code>.list</code> file(s) start with <code>sso-</code>, e.g.,</p>
<pre><code>sso-https://example.com/protected/page
</code></pre>
<h4 id="running">Running</h4>
<p>Link scraping is automatically enabled in A2rchi, you don't need to add any arguments to the <code>create</code> command.</p>
<hr />
<h3 id="git-scraping">Git scraping</h3>
<p>In some cases, the RAG input may be documentations based on MKDocs git repositories.
Instead of scraping these sites as regular HTML sites you can obtain the relevant content using the <code>GitScraper</code> class.</p>
<h4 id="configuration_1">Configuration</h4>
<p>To configure it, simply add the following field in the configuration file:</p>
<pre><code class="language-yaml">utils:
  git:
    enabled: {{ utils.git.enabled | default(false, true) }}
</code></pre>
<p>In the input lists, make sure to prepend <code>git-</code> to the URL of the repositories you are interested in scraping.</p>
<pre><code class="language-nohighlight">git-https://gitlab.cern.ch/cms-tier0-ops/documentation.git
</code></pre>
<h4 id="secrets_1">Secrets</h4>
<p>You will need to provide a git username and token in the secrets file,</p>
<pre><code class="language-bash">GIT_USERNAME=your_username
GIT_TOKEN=your_token
</code></pre>
<h4 id="running_1">Running</h4>
<p>Git link scraping is automatically enabled in A2rchi once enabled in the config, you don't need to add any arguments to the <code>create</code> command.</p>
<hr />
<h3 id="jira">JIRA</h3>
<p>The JIRA integration allows A2rchi to fetch issues and comments from specified JIRA projects and add them to the vector store, using the <code>JiraScraper</code> class.</p>
<h4 id="configuration_2">Configuration</h4>
<p>Select which projects to scrape in the configuration file:</p>
<pre><code class="language-yaml">jira:
    url: {{ utils.jira.JIRA_URL }}
    projects: 
      {%- for project in utils.jira.JIRA_PROJECTS %}
      - {{ project }}
      {%- endfor %}
    anonymize_data: {{ utils.jira.ANONYMIZE_DATA | default(true, true) }}
</code></pre>
<p>You can turn on an automatic anonymizer of the data fetched from JIRA via the <code>anonymize_data</code> config.</p>
<pre><code class="language-yaml">  anonymizer:
    nlp_model: {{ utils.anonymizer.nlp_model | default('en_core_web_sm', true) }}
    excluded_words: 
      {%- for word in utils.anonymizer.excluded_words | default(['John', 'Jane', 'Doe']) %}
      - {{ word }}
      {%- endfor %}
    greeting_patterns: 
      {%- for pattern in utils.anonymizer.greeting_patterns | default(['^(hi|hello|hey|greetings|dear)\\b', '^\\w+,\\s*']) %}
      - {{ pattern }}
      {%- endfor %}
    signoff_patterns: 
      {%- for pattern in utils.anonymizer.signoff_patterns | default(['\\b(regards|sincerely|best regards|cheers|thank you)\\b', '^\\s*[-~]+\\s*$']) %}
      - {{ pattern }}
      {%- endfor %}
    email_pattern: '{{ utils.anonymizer.email_pattern | default(&quot;[\\w\\.-]+@[\\w\\.-]+\\.\\w+&quot;) }}'
    username_pattern: '{{ utils.anonymizer.username_pattern | default(&quot;\\[~[^\\]]+\\]&quot;) }}'
</code></pre>
<p>The anonymizer will remove names, emails, usernames, greetings, signoffs, and any other words you specify from the fetched data.
This is useful if you want to avoid having personal information in the vector store.</p>
<h4 id="secrets_2">Secrets</h4>
<p>A personal access token (PAT) is required to authenticate and authorize with JIRA.
This token should be placed in a secrets file as <code>JIRA_PAT</code>.</p>
<h4 id="running_2">Running</h4>
<p>To enable JIRA scraping, run with,</p>
<pre><code class="language-bash">a2rchi create [...] --services=jira
</code></pre>
<hr />
<h3 id="adding-documents-and-the-uploader-interface">Adding Documents and the Uploader Interface</h3>
<h4 id="adding-documents">Adding Documents</h4>
<p>There are two main ways to add documents to A2rchi's vector database. They are:</p>
<ul>
<li>Manually adding files while the service is running via the uploader GUI</li>
<li>Directly copying files into the container</li>
</ul>
<p>These methods are outlined below.</p>
<h4 id="manual-uploader">Manual Uploader</h4>
<p>In order to upload documents while A2rchi is running via an easily accessible GUI, use the upload-manager built into the system.
The manager is run as an additional docker service by adding the following argument to the CLI command: </p>
<pre><code class="language-bash">a2rchi create [...] --services=uploader 
</code></pre>
<p>The exact port may vary based on configuration (default is <code>5001</code>).
A simple <code>docker ps -a</code> command run on the server will inform which port it's being run on.</p>
<p>In order to access the manager, one must first make an account. To do this, first get the ID or name of the uploader container using <code>docker ps -a</code>. Then, accese the container using</p>
<pre><code class="language-nohighlight">docker exec -it &lt;CONTAINER-ID&gt; bash
</code></pre>
<p>so you can run</p>
<pre><code>python bin/service_create_account.py
</code></pre>
<p>from the <code>/root/A2rchi/a2rchi</code> directory.Â·
This script will guide you through creating an account. Note that we do not guarantee the security of this account, so never upload critical passwords to create it.</p>
<p>Once you have created an account, visit the outgoing port of the data manager docker service and then log in.
The GUI will then allow you to upload documents while A2rchi is still running. Note that it may take a few minutes for all the documents to upload.</p>
<h4 id="directly-copying-files-to-the-container">Directly copying files to the container</h4>
<p>The documents used for RAG live in the chat container at <code>/root/data/&lt;directory&gt;/&lt;files&gt;</code>. Thus, in a pinch, you can <code>docker/podman cp</code> a file at this directory level, e.g., <code>podman/docker cp myfile.pdf &lt;container name or ID&gt;:/root/data/&lt;new_dir&gt;/</code>. If you need to make a new directory in the container, you can do <code>podman exec -it &lt;container name or ID&gt; mkdir /root/data/&lt;new_dir&gt;</code>.</p>
<hr />
<h3 id="redmine">Redmine</h3>
<p>Input from Redmine tickets as a data source.</p>
<h4 id="secrets_3">Secrets</h4>
<pre><code>REDMINE_URL
REDMINE_USER
REDMINE_PW
REDMINE_PROJECT
</code></pre>
<h4 id="running_3">Running</h4>
<pre><code class="language-bash">a2rchi create [...] --services=redmine
</code></pre>
<hr />
<h2 id="interfacesservices">Interfaces/Services</h2>
<p>These are the different apps that A2rchi supports, which allow you to interact with the AI pipelines.</p>
<h3 id="piazza-interface">Piazza Interface</h3>
<p>Set up A2rchi to read posts from your Piazza forum and post draft responses to a specified Slack channel. To do this, a Piazza login (email and password) is required, plus the network ID of your Piazza channel, and lastly, a Webhook for the slack channel A2rchi will post to. See below for a step-by-step description of this.</p>
<ol>
<li>Go to <a href="https://api.slack.com/apps">https://api.slack.com/apps</a> and sign in to workspace where you will eventually want A2rchi to post to (note doing this in a business workspace like the MIT one will require approval of the app/bot).</li>
<li>Click 'Create New App', and then 'From scratch'. Name your app and again select the correct workspace. Then hit 'Create App'</li>
<li>Now you have your app, and there are a few things to configure before you can launch A2rchi:</li>
<li>Go to Incoming Webhooks under Features, and toggle it on.</li>
<li>Click 'Add New Webhook', and select the channel you want A2rchi to post to.</li>
<li>Now, copy the 'Webhook URL' and paste it into the secrets file, and handle it like any other secret!</li>
</ol>
<h4 id="configuration_3">Configuration</h4>
<p>Beyond standard required configuration fields, the network ID of the Piazza channel is required (see below for an example config). You can get the network ID by simply navigating to the class homepage, and grabbing the sequence that follows 'https://piazza.com/class/'. For example, the 8.01 Fall 2024 homepage is: 'https://piazza.com/class/m0g3v0ahsqm2lg'. The network ID is thus 'm0g3v0ahsqm2lg'.</p>
<p>Example minimal config for the Piazza interface:</p>
<pre><code>name: bare_minimum_configuration #REQUIRED

global:
  TRAINED_ON: &quot;Your class materials&quot; #REQUIRED

chains:
  input_lists: #REQUIRED
    - configs/class_info.list # list of websites with class info

a2rchi:
  [... a2rchi config ...]

utils:
  piazza:
    network_id: &lt;your Piazza network ID here&gt; # REQUIRED
</code></pre>
<h4 id="secrets_4">Secrets</h4>
<p>The necessary secrets for deploying the Piazza service are the following:</p>
<pre><code class="language-bash">PIAZZA_EMAIL=...
PIAZZA_PASSWORD=...
SLACK_WEBHOOK=...
</code></pre>
<p>The Slack webhook secret is described above. The Piazza email and password should be those of one of the class instructors. Remember to put this information in files named following what is written above.</p>
<h4 id="running_4">Running</h4>
<p>To run the Piazza service, simply add the piazza flag. For example:</p>
<pre><code class="language-bash">a2rchi create [...] --services=piazza 
</code></pre>
<hr />
<h3 id="redminemailbox-interface">Redmine/Mailbox Interface</h3>
<p>A2rchi will read all new tickets in a Redmine project, and draft a response as a comment to the ticket.
Once the ticket is updated to the "Resolved" status by an admin, A2rchi will send the response as an email to the user who opened the ticket.
The admin can modify A2rchi's response before sending it out.</p>
<h4 id="configuration_4">Configuration</h4>
<pre><code class="language-yaml">redmine: 
  redmine_update_time: {{ utils.redmine.redmine_update_time | default(10, true) }}
  answer_tag: {{ utils.redmine.answer_tag | default('-- A2rchi -- Resolving email was sent', true) }}
</code></pre>
<h4 id="secrets_5">Secrets</h4>
<pre><code class="language-py">required_secrets=['IMAP_USER', 'IMAP_PW', 'REDMINE_URL', 'REDMINE_USER', 
                            'REDMINE_PW', 'REDMINE_PROJECT', 'SENDER_SERVER', 'SENDER_PORT', 
                            'SENDER_REPLYTO', 'SENDER_USER', 'SENDER_PW']
</code></pre>
<h4 id="running_5">Running</h4>
<pre><code class="language-bash">a2rchi create [...] --services=redmine-mailer  
</code></pre>
<hr />
<h3 id="mattermost-interface">Mattermost Interface</h3>
<p>Set up A2rchi to read posts from your Mattermost forum and post draft responses to a specified Mattermost channel.</p>
<h4 id="configuration_5">Configuration</h4>
<pre><code class="language-yaml">mattermost:
  update_time: {{ utils.mattermost.update_time | default(60, true) }}
</code></pre>
<h4 id="secrets_6">Secrets</h4>
<p>You need to specify a webhook, a key and the id of two channels to read and write. Should be specified like this.</p>
<pre><code class="language-bash">MATTERMOST_WEBHOOK=...
MATTERMOST_KEY=...
MATTERMOST_CHANNEL_ID_READ=...
MATTERMOST_CHANNEL_ID_WRITE=...
</code></pre>
<h4 id="running_6">Running</h4>
<p>To run the Mattermost service, simply add the Mattermost to the services flag. For example:</p>
<pre><code class="language-bash">a2rchi create [...] --services=mattermost
</code></pre>
<hr />
<h3 id="grafana-interface">Grafana Interface</h3>
<p>Monitor the performance of your A2rchi instance with the Grafana interface. This service provides a web-based dashboard to visualize various metrics related to system performance, LLM usage, and more.</p>
<blockquote>
<p>Note, if you are deploying a version of A2rchi you have already used (i.e., you haven't removed the images/volumes for a given <code>--name</code>), the postgres will have already been created without the Grafana user created, and it will not work, so make sure to deploy a fresh instance.</p>
</blockquote>
<h4 id="configuration_6">Configuration</h4>
<pre><code class="language-yaml">grafana:
  external_port: {{ interfaces.grafana.external_port | default(3000, true) }}
</code></pre>
<h4 id="secrets_7">Secrets</h4>
<p>To run the Grafana service, you first need to specify a password for the Grafana to access the postgres database that stores the information.
Set the environment variable as follows in the secrets file:</p>
<pre><code class="language-bash">PG_PASSWORD=&lt;your_password&gt;
</code></pre>
<h4 id="running_7">Running</h4>
<p>Once this is set, add the following argument to your <code>a2rchi create</code> command, e.g.,</p>
<pre><code class="language-bash">a2rchi create [...] --services=grafana
</code></pre>
<p>and you should see something like this</p>
<pre><code class="language-nohighlight">CONTAINER ID  IMAGE                                     COMMAND               CREATED        STATUS                  PORTS                             NAMES
d27482864238  localhost/chromadb-gtesting2:2000         uvicorn chromadb....  9 minutes ago  Up 9 minutes (healthy)  0.0.0.0:8000-&gt;8000/tcp, 8000/tcp  chromadb-gtesting2
87f1c7289d29  docker.io/library/postgres:16             postgres              9 minutes ago  Up 9 minutes (healthy)  5432/tcp                          postgres-gtesting2
40130e8e23de  docker.io/library/grafana-gtesting2:2000                        9 minutes ago  Up 9 minutes            0.0.0.0:3000-&gt;3000/tcp, 3000/tcp  grafana-gtesting2
d6ce8a149439  localhost/chat-gtesting2:2000             python -u a2rchi/...  9 minutes ago  Up 9 minutes            0.0.0.0:7861-&gt;7861/tcp            chat-gtesting2
</code></pre>
<p>where the grafana interface is accessible at <code>your-hostname:3000</code>. To change the external port from <code>3000</code>, you can do this in the config at <code>interfaces:grafana:EXTERNAL_PORT</code>. The default login and password are both "admin", which you will be prompted to change should you want to after first logging in. Navigate to the A2rchi dashboard from the home page by going to the menu &gt; Dashboards &gt; A2rchi &gt; A2rchi Usage. Note, <code>your-hostname</code> here is the just name of the machine. Grafana uses its default configuration which is <code>localhost</code> but unlike the chat interface, there are no APIs where we template with a selected hostname, so the container networking handles this nicely.</p>
<blockquote>
<p>Pro tip: once at the web interface, for the "Recent Conversation Messages (Clean Text + Link)" panel, click the three little dots in the top right hand corner of the panel, click "Edit", and on the right, go to e.g., "Override 4" (should have Fields with name: clean text, also Override 7 for context column) and override property "Cell options &gt; Cell value inspect". This will allow you to expand the text boxes with messages longer than can fit. Make sure you click apply to keep the changes.</p>
<p>Pro tip 2: If you want to download all of the information from any panel as a CSV, go to the same three dots and click "Inspect", and you should see the option.</p>
</blockquote>
<hr />
<h3 id="grader-interface">Grader Interface</h3>
<p>Interface to launch a website which for a provided solution and rubric (and a couple of other things detailed below), will grade scanned images of a handwritten solution for the specified problem(s).</p>
<blockquote>
<p>Nota bene: this is not yet fully generalized and "service" ready, but instead for testing grading pipelines and a base off of which to build a potential grading app.</p>
</blockquote>
<h4 id="requirements">Requirements</h4>
<p>To launch the service the following files are required:</p>
<ul>
<li><code>users.csv</code>. This file is .csv file that contains two columns: "MIT email" and "Unique code", e.g.:</li>
</ul>
<pre><code class="language-nohighlight">MIT email,Unique code
username@mit.edu,222
</code></pre>
<p>For now, the system requires the emails to be in the MIT domain, namely, contain "@mit.edu". TODO: make this an argument that is passed (e.g., school/email domain)</p>
<ul>
<li><code>solution_with_rubric_*.txt</code>. These are .txt files that contain the problem solution followed by the rubric. The naming of the files should follow exactly, where the <code>*</code> is the problem number. There should be one of these files for every problem you want the app to be able to grade. The top of the file should be the problem name with a line of dashes ("-") below, e.g.:</li>
</ul>
<pre><code>Anti-Helmholtz Coils
---------------------------------------------------
</code></pre>
<p>These files should live in a directory which you will pass to the config, and A2rchi will handle the rest.</p>
<ul>
<li><code>admin_password.txt</code>. This file will be passed as a secret and be the admin code to login in to the page where you can reset attempts for students.</li>
</ul>
<h4 id="secrets_8">Secrets</h4>
<p>The only grading specific secret is the admin password, which like shown above, should be put in the following file</p>
<pre><code class="language-bash">ADMIN_PASSWORD=your_password
</code></pre>
<p>Then it behaves like any other secret.</p>
<h4 id="configuration_7">Configuration</h4>
<p>The required fields in the configuration file are different from the rest of the A2rchi services. Below is an example:</p>
<pre><code>name: grading_test # REQUIRED

global:
  TRAINED_ON: &quot;rubrics, class info, etc.&quot; # REQUIRED

a2rchi:
  pipelines:
    - GradingPipeline 
  pipeline_map:
    GradingPipeline:
      prompts:
        required:
          final_grade_prompt: configs/prompts/final_grade.prompt
      models:
        required:
          final_grade_model: OllamaInterface
    ImageProcessingPipeline:
      prompts:
        required:
          image_processing_prompt: configs/prompts/image_processing.prompt
      models:
        required:
          image_processing_model: OllamaInterface

interfaces:
  grader_app:
    num_problems: 1 # REQUIRED
    local_rubric_dir: ~/grading/my_rubrics # REQUIRED
    local_users_csv_dir: ~/grading/logins # REQUIRED

data_manager:
  [...]
</code></pre>
<ol>
<li><code>name</code> -- The name of your configuration (required).</li>
<li><code>global.TRAINED_ON</code> -- A brief description of the data or materials A2rchi is trained on (required).</li>
<li><code>a2rchi.pipelines</code> -- List of pipelines to use (e.g., <code>GradingPipeline</code>, <code>ImageProcessingPipeline</code>).</li>
<li><code>a2rchi.pipeline_map</code> -- Mapping of pipelines to their required prompts and models.</li>
<li><code>a2rchi.pipeline_map.GradingPipeline.prompts.required.final_grade_prompt</code> -- Path to the grading prompt file for evaluating student solutions.</li>
<li><code>a2rchi.pipeline_map.GradingPipeline.models.required.final_grade_model</code> -- Model class for grading (e.g., <code>OllamaInterface</code>, <code>HuggingFaceOpenLLM</code>).</li>
<li><code>a2rchi.pipeline_map.ImageProcessingPipeline.prompts.required.image_processing_prompt</code> -- Path to the prompt file for image processing.</li>
<li><code>a2rchi.pipeline_map.ImageProcessingPipeline.models.required.image_processing_model</code> -- Model class for image processing (e.g., <code>OllamaInterface</code>, <code>HuggingFaceImageLLM</code>).</li>
<li><code>interfaces.grader_app.num_problems</code> -- Number of problems the grading service should expect (must match the number of rubric files).</li>
<li><code>interfaces.grader_app.local_rubric_dir</code> -- Directory containing the <code>solution_with_rubric_*.txt</code> files.</li>
<li><code>interfaces.grader_app.local_users_csv_dir</code> -- Directory containing the <code>users.csv</code> file.</li>
</ol>
<h4 id="running_8">Running</h4>
<pre><code class="language-bash">a2rchi create [...] --services=grader
</code></pre>
<hr />
<h2 id="models">Models</h2>
<p>Models are either:</p>
<ol>
<li>Hosted locally, either via VLLM or HuggingFace transformers.</li>
<li>Accessed via an API, e.g., OpenAI, Anthropic, etc.</li>
<li>Accessed via an Ollama server instance.</li>
</ol>
<h3 id="local-models">Local Models</h3>
<p>To use a local model, specify one of the local model classes in <code>models.py</code>:</p>
<ul>
<li><code>HuggingFaceOpenLLM</code></li>
<li><code>HuggingFaceImageLLM</code></li>
<li><code>VLLM</code></li>
</ul>
<h3 id="models-via-apis">Models via APIs</h3>
<p>We support the following model classes in <code>models.py</code> for models accessed via APIs:</p>
<ul>
<li><code>OpenAILLM</code></li>
<li><code>ClaudeLLM</code></li>
<li><code>AnthropicLLM</code></li>
</ul>
<h3 id="ollama">Ollama</h3>
<p>In order to use an Ollama server instance for the chatbot, it is possible to specify <code>OllamaInterface</code> for the model name. To then correctly use models on the Ollama server, in the keyword args, specify both the url of the server and the name of a model hosted on the server.  </p>
<pre><code>a2rchi:
  chain:
    model_class_map:
      OllamaInterface:
        kwargs:
          base_model: &quot;gemma3&quot; # example 
          url: &quot;url-for-server&quot; 

</code></pre>
<p>In this case, the <code>gemma3</code> model is hosted on the Ollama server at <code>url-for-server</code>. You can check which models are hosted on your server by going to <code>url-for-server/models</code>.</p>
<hr />
<h2 id="other">Other</h2>
<p>Some useful additional features supported by the framework.</p>
<h3 id="add-chromadb-document-management-api-endpoints">Add ChromaDB Document Management API Endpoints</h3>
<h5 id="debugging-chromadb-endpoints">Debugging ChromaDB endpoints</h5>
<p>Debugging REST API endpoints to the A2rchi chat application for programmatic access to the ChromaDB vector database can be exposed with the following configuration change.
To enable the ChromaDB endpoints, add the following to your config file under <code>interfaces.chat_app</code>:</p>
<pre><code class="language-yaml">interfaces:
  chat_app:
    # ... other config options ...
    enable_debug_chroma_endpoints: true  # Default: false
</code></pre>
<h6 id="chromadb-endpoints-info">ChromaDB  Endpoints Info</h6>
<h6 id="apilist_docs-get"># <code>/api/list_docs</code> (GET)</h6>
<p>Lists all documents indexed in ChromaDB with pagination support.</p>
<p><strong>Query Parameters:</strong>
- <code>page</code>: Page number (1-based, default: 1)
- <code>per_page</code>: Documents per page (default: 50, max: 500)
- <code>content_length</code>: Content preview length (default: -1 for full content)</p>
<p><strong>Response:</strong></p>
<pre><code class="language-json">{
  &quot;pagination&quot;: {
    &quot;page&quot;: 1,
    &quot;per_page&quot;: 50,
    &quot;total_documents&quot;: 1250,
    &quot;total_pages&quot;: 25,
    &quot;has_next&quot;: true,
    &quot;has_prev&quot;: false
  },
  &quot;documents&quot;: [...]
}
</code></pre>
<h6 id="apisearch_docs-post"># <code>/api/search_docs</code> (POST)</h6>
<p>Performs semantic search on the document collection using vector similarity.</p>
<p><strong>Request Body:</strong>
- <code>query</code>: Search query string (required)
- <code>n_results</code>: Number of results (default: 5, max: 100)
- <code>content_length</code>: Max content length (default: -1, max: 5000)
- <code>include_full_content</code>: Include complete document content (default: false)</p>
<p><strong>Response:</strong></p>
<pre><code class="language-json">{
  &quot;query&quot;: &quot;machine learning&quot;,
  &quot;search_params&quot;: {...},
  &quot;documents&quot;: [
    {
      &quot;content&quot;: &quot;Document content...&quot;,
      &quot;content_length&quot;: 1200,
      &quot;metadata&quot;: {...},
      &quot;similarity_score&quot;: 0.85
    }
  ]
}
</code></pre>
<hr />
<h1 id="vector-store">Vector Store</h1>
<p>TODO: explain vector store, retrievers, and related techniques</p>
<h3 id="stemming">Stemming</h3>
<p>By specifying the option stemming within ones configuration, stemming functionality for the documents in A2rchi will be enabled. By doing so, documents inserted into the ragging pipeline, as well as the query that is matched with them, will be stemmed and simplified for faster and more accurate lookup. </p>
<pre><code class="language-yaml">utils:
  data_manager:
    stemming:
      ENABLED: true
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../quickstart/" class="btn btn-neutral float-left" title="Quickstart"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../advanced_setup_deploy/" class="btn btn-neutral float-right" title="Advanced Setup & Deployment">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/mit-submit/A2rchi" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../quickstart/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../advanced_setup_deploy/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
